<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>iDaily Pro東北関東大震災の募金プロジェクトのご報告</title>

<link rel="shortcut icon" href="http://www.rakutec.com/wp-content/uploads/2010/10/fav.png" />
<link rel="stylesheet" href="960gs/reset.css" />
<link rel="stylesheet" href="960gs/text.css" />
<link rel="stylesheet" href="960gs/960.css" />
<link rel="stylesheet" href="style.css" />

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
<script type="text/javascript" src="corner/jquery.corner.js?v2.11"></script>
<script type="text/javascript" src="tempo/tempo.min.js"></script>
<script type="text/javascript" src="l10n.js/l10n.min.js"></script>
<script type="text/javascript" src="localizations.js"></script>
<script type="text/javascript" src="smb/smb.js"></script>
</head>
<body>
<div id="top_shadow"></div>
<div class="container_12">
    <div class="grid_6 logo">
        <h1 class="l10n" id="title">iDaily Pro東北関東大震災の募金プロジェクトのご報告</h1>
	</div>
    <div class="grid_6 lang">
		<ul>
			<li><a href="#ja">日本語</a><span>|</span></li>
			<li><a href="#en">English</a><span>|</span></li>
			<li><a href="#zh_CN">中文</a><span>|</span></li>
			<li><a href="#kr">한국어</a></li>
		</ul>
	</div>
	<div class="clear"></div>
    <!-- end of row -->
    <div class="grid_12 round_box">
    	<div class="grid_8 main_left">
    	    <div class="text_wrapper">
    	    <div class="l10n" id="page_intro">
        	    <p>3月11日 午後2時46分頃、三陸沖を震源とする非常に強い地震が発生し、これにより東北地方を中心として広い範囲で大きな被害が生じております。</p>
                <p>被災された方々を支援する為、弊社のiPhoneアプリ <a href="http://itunes.apple.com/jp/app/idaily-pro/id390691023?mt=8" class="high">iDaily&nbsp;Pro</a> の<strong>3月11日〜3月31日の売り上げを全額 <sup>*1</sup>日本赤十字(予定)に寄付する。</strong>僅かな力ながら、みなさまのご支援をお願いいたします。</p>
                <p>被災し亡くなられた全ての方々の冥福と生きておられる方々の幸運をお祈りいたします。</p>
            </div>
    	    <div id="social_buttons"><script type="text/javascript"><!--
                smb.show(smb.twitter | smb.facebook);
            //--></script>
    	    </div>
            <ul class="l10n" id="page_sup">
                <li>*1 Apple社により30%手数料相当額が控除された金額となります。</li>
                <li>*2 毎日深夜にApple社の販売リポートにより前日までの数字を更新します。</li>
            </ul>
            </div>
        </div>
    	<div class="prefix_8 main_right">
    	    <div class="l10n" id="target_amount">目標金額：1,000,000円</div>
    	    <div class="l10n" id="amount">511,449<span>円</span></div>
    	    <div class="l10n" id="desc">3月20日現在<sup>*2</sup>お預かりした義援金</div>
    	    <div class="l10n" id="support"><p>iDaily ProをApp Storeにてご購入頂くことで</p>
        	    <a class="button" href="itms://itunes.apple.com/jp/app/idaily-pro/id390691023?mt=8#" onclick="this.blur();"><span>応援する</span></a>
    	    </div>
        </div>
    </div>
    <!-- end of row -->
    <div class="grid_12 sec_header">
        <h2 class="l10n" id="title_report"><span>進捗</span>のご報告</h2>
    </div>
    <!-- end of row -->
    <div class="grid_8 round_box graph">
        <div class="loading" id="daily_line_graph"><!-- <img  src="http://chart.apis.google.com/chart?chf=bg,s,FFFFFF&chxl=0:|3%2F11+|3%2F16|3%2F21|3%2F26|3%2F31&chxr=1,0,150&chxs=0,676767,12.167,0.333,lt,676767|1,676767,11.167,0,l,676767&chxtc=0,3&chxt=x,y&chs=600x260&cht=lxy&chco=FF0000&chd=t:-1|41.781,30.633,23.328,19.56,12.282,14.105,16.154,9.623,6.267,8.995,15.474,17.919,17.948,11.214,9.237,13.162,21.586,22.453,21.663,29.252,33.255,37.165,40.162,43.81,51.074,57.016&chdl=Apps Sold&chdlp=b&chls=3&chma=5,1,5,35|0,2&chm=d,FFFFFF,0,-1,10"/> --></div>
    </div>
    <div class="grid_4 round_box graph">
        <div class="loading" id="country_pie_graph"><!-- <img  src="http://chart.apis.google.com/chart?chf=bg,s,FFFFFF&chs=280x260&cht=p&chco=FF9900|FF0000|3366CC|3399CC|BBCCED&chd=s:HUEbE&chdl=Japan|China|Korean|US|Other&chdlp=b&chp=0.033&chma=0,0,0,2|3"/> --></div>
    </div>
    <!-- end of row -->
    <div class="grid_12 sec_header">
        <h2 class="l10n" id="title_user_voice"><span>利用者</span>の声 #idaily</h2>
    </div>
    <!-- end of row -->
    <!-- Tweets -->
    <div class="grid_12 round_box" id="tweets">
        <ol><li class="row" data-template>
    		<div class="grid_3 user">
    			<img src="{{profile_image_url}}" height="48" width="48" />
    			<h3><a href="http://twitter.com/{{from_user}}">{{truncated_from_user}}</a></h3>
    		</div>
    		<p class="prefix_3 text">{{text}}</p>
    		<div class="clear"></div>
        </li></ol>
    </div>
    <!-- end of row -->
    
    <hr class="grid_12 footer_hr">
    
    <!-- end of row -->
    <div class="grid_12 sec_header">
        <h2 class="l10n" id="title_made_possible">このページを<span>可能に</span>したのは</h2>
    </div>
    <!-- end of row -->
    <div class="container_12 footer">
        <div class="grid_3 lib">
            <ul>
                <li><a class="high" href="http://960.gs/">960.gs</a> by <a href="https://github.com/nathansmith">Nathan Smith</a>
                    <p>an effort to streamline web development workflow by providing commonly used dimensions...</p>
                </li>
                <li><a class="high" href="http://code.google.com/intl/en/apis/chart/">Google Chart API</a>
                    <p>lets you dynamically generate charts with a URL string.</p>
                </li>
                <li><a class="high" href="http://cielquis.net/smb/">Social Media Buttons</a> by <a href="http://twitter.com/#!/tt_clown">tt_clown</a>
                    <p>様々な Web サービスが提供しているソーシャル（メディア）ボタンと呼ばれるボタンを表示させるための JavaScript ライブラリです．</p>
                </li>
            </ul>
        </div>
        <div class="grid_3 lib">
            <ul>
                <li><a class="high" href="https://github.com/eligrey/l10n.js">l10n.js</a> by <a href="https://github.com/eligrey">Eli Grey</a>
                    <p>a JavaScript library that enables passive localization through native JavaScript methods.</p>
                </li>
                <li><a class="high" href="https://github.com/malsup/corner">corner</a> by <a href="https://github.com/malsup">Mike Alsup</a>
                    <p>a wounderful jquery plugin to creating rounded corners on elements.</p>
                </li>
                <li><a class="high" href="http://stackoverflow.com/questions/282758/truncate-a-string-nicely-to-fit-within-a-given-pixel-width">truncate-a-string-by-pixel</a> method
                    <p>let you truncate a string by a desired width and its CSS class. Automatically create an ABBR tag if truncated.</p>
                </li>
            </ul>
        </div>
        <div class="grid_3 lib">
            <ul>
                <li><a class="high" href="https://github.com/twigkit/tempo">tempo</a> by <a href="https://github.com/mrolafsson">Hjortur Stefan Olafsson</a>
                    <p>a tiny JSON rendering engine that enables you to craft data templates in pure HTML.</p>
                </li>
                <li><a class="high" href="http://www.oscaralexander.com/tutorials/how-to-make-sexy-buttons-with-css.html">sexy buttons</a> by <span>Alex Griffioen</span>
                    <p>The tutorial will teach you how to create pretty looking textual buttons (with alternate pressed state) using CSS.</p>
                </li>
            </ul>
        </div>
        <div class="grid_3 copyright">
            <p>© 2011 Rakuraku Technologies Inc. All rights reserved.</p>
            <p>All source code of this website is open-sourced on <a href="https://github.com/rjyo/app4jp">github</a>.</p>
        </div>
    </div>
    <!-- end of row -->
</div>
<script type="text/javascript">
	if (location.hash) {
		String.locale = location.hash.substr(1);	
	}
	
	var localize = function (string, fallback) {
		var localized = string.toLocaleString();
		if (localized !== string) {
			return localized;
		} else {
			return fallback;
		}
	};

    function replaceURLWithHTMLLinks(text) {    
        var exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/i;
        return text.replace(exp,"<a class='high' href='$1'>$1</a>"); 
    }
    
    function l10nPage() {
        $.each($(".l10n"), function(index, node) {
           var loc = localize($(node).attr('id'), $(node).html());
           $(node).html(loc);
        });
        // $("#page_intro").html(localize("%page_intro", $("#page_intro").html()));
    }
    
    function loadGraphs(graph_url, graph_container) {
        $('<img />')
            .attr('src', graph_url)
            .load(function(){
                graph_container.toggleClass('loading');
                graph_container.append( $(this) );
            });
    }
    
    function fitStringToWidth(str,width,className) {
      // str    A string where html-entities are allowed but no tags.
      // width  The maximum allowed width in pixels
      // className  A CSS class name with the desired font-name and font-size. (optional)
      // ----
      // _escTag is a helper to escape 'less than' and 'greater than'
      function _escTag(s){ return s.replace("<","&lt;").replace(">","&gt;");}

      //Create a span element that will be used to get the width
      var span = document.createElement("span");
      //Allow a classname to be set to get the right font-size.
      if (className) span.className=className;
      span.style.display='inline';
      span.style.visibility = 'hidden';
      span.style.padding = '0px';
      document.body.appendChild(span);

      var result = _escTag(str); // default to the whole string
      span.innerHTML = result;
      // Check if the string will fit in the allowed width. NOTE: if the width
      // can't be determinated (offsetWidth==0) the whole string will be returned.
      if (span.offsetWidth > width) {
        var posStart = 0, posMid, posEnd = str.length, posLength;
        // Calculate (posEnd - posStart) integer division by 2 and
        // assign it to posLength. Repeat until posLength is zero.
        while (posLength = (posEnd - posStart) >> 1) {
          posMid = posStart + posLength;
          //Get the string from the begining up to posMid;
          span.innerHTML = _escTag(str.substring(0,posMid)) + '&hellip;';

          // Check if the current width is too wide (set new end)
          // or too narrow (set new start)
          if ( span.offsetWidth > width ) posEnd = posMid; else posStart=posMid;
        }

        result = '<abbr title="' +
          str.replace("\"","&quot;") + '">' +
          _escTag(str.substring(0, posStart)) +
          '&hellip;<\/abbr>';
      }
      document.body.removeChild(span);
      return result;
    }
    
    $(document).ready(function() {
        $(".round_box").corner();
        
        $(".lang a").click(function() {
        	var lang = $(this).attr('href').substr(1);
        	String.locale = lang;
        	l10nPage();
        });

		loadGraphs('images/country_pie_graph.png', $('#country_pie_graph'));
        loadGraphs('images/daily_line_graph.png', $('#daily_line_graph'));
        l10nPage();
        
        var twitter = Tempo.prepare('tweets').notify(function(event) {
			if (event.type === TempoEvent.Types.RENDER_STARTING || event.type === TempoEvent.Types.RENDER_COMPLETE) {
				$('ol').toggleClass('loading');
			}
		});
		twitter.starting();
		$.getJSON("http://search.twitter.com/search.json?q='idaily'&rpp=10&callback=?", function(data) {
		    $.each(data.results, function(index, value) {
		        value.text = replaceURLWithHTMLLinks(value.text);
		        value.truncated_from_user = fitStringToWidth(value.from_user, 100, 'user');
		    });
			twitter.render(data.results);
		});
		
	});
	
</script>
</body>
</html>